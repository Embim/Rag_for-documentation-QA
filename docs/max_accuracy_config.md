# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

## ‚ö†Ô∏è –ü—Ä–æ–±–ª–µ–º–∞ —Ç–µ–∫—É—â–µ–π –∫–æ–º–∞–Ω–¥—ã

–í–∞—à–∞ —Ç–µ–∫—É—â–∞—è –∫–æ–º–∞–Ω–¥–∞:
```bash
python main_pipeline.py all --force --llm-clean --optimize --optimize-mode test --optimize-sample 5
```

**–ü—Ä–æ–±–ª–µ–º—ã:**
- `--optimize-mode test` - —Ç–æ–ª—å–∫–æ **5 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Å–ª–∏—à–∫–æ–º –º–∞–ª–æ!)
- `--optimize-sample 5` - —Ç–æ–ª—å–∫–æ **5 –≤–æ–ø—Ä–æ—Å–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (—Å–ª–∏—à–∫–æ–º –º–∞–ª–æ!)
- `--min-usefulness` –Ω–µ —É–∫–∞–∑–∞–Ω (–∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è 0.3 –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - —Å–ª–∞–±–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è)

**–û–∂–∏–¥–∞–µ–º–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:** ~0.75-0.80 (—Å—Ä–µ–¥–Ω—è—è)

---

## ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–æ–ª–Ω—É—é –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é

```bash
# –í–ê–†–ò–ê–ù–¢ 1: –ü–æ–ª–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å)
python main_pipeline.py all \
  --force \
  --llm-clean \
  --min-usefulness 0.5 \
  --optimize \
  --optimize-mode full \
  --optimize-sample 100
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--optimize-mode full` - **1225 –∫–æ–º–±–∏–Ω–∞—Ü–∏–π** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (–≤–º–µ—Å—Ç–æ 5)
- `--optimize-sample 100` - **100 –≤–æ–ø—Ä–æ—Å–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–≤–º–µ—Å—Ç–æ 5)
- `--min-usefulness 0.5` - –±–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –º—É—Å–æ—Ä–∞

**–û–∂–∏–¥–∞–µ–º–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:** ~0.90-0.95+
**–í—Ä–µ–º—è:** ~20-25 —á–∞—Å–æ–≤ (—Å API —Ä–µ–∂–∏–º–æ–º: ~4-6 —á–∞—Å–æ–≤)

---

### 2. –ö–æ–º–ø—Ä–æ–º–∏—Å—Å: –±—ã—Å—Ç—Ä–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –í–ê–†–ò–ê–ù–¢ 2: –ë—ã—Å—Ç—Ä–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (—Ö–æ—Ä–æ—à–∏–π –±–∞–ª–∞–Ω—Å)
python main_pipeline.py all \
  --force \
  --llm-clean \
  --min-usefulness 0.5 \
  --optimize \
  --optimize-mode quick \
  --optimize-sample 50
```

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- `--optimize-mode quick` - **54 –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏** –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
- `--optimize-sample 50` - **50 –≤–æ–ø—Ä–æ—Å–æ–≤** –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- `--min-usefulness 0.5` - —Å—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è

**–û–∂–∏–¥–∞–µ–º–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:** ~0.85-0.90
**–í—Ä–µ–º—è:** ~8-12 —á–∞—Å–æ–≤ (—Å API —Ä–µ–∂–∏–º–æ–º: ~2-3 —á–∞—Å–∞)

---

### 3. –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ API —Ä–µ–∂–∏–º

```bash
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
export LLM_MODE=api
export LLM_API_MODEL=tngtech/deepseek-r1t2-chimera:free  # –∏–ª–∏ –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å
export OPENROUTER_API_KEY=sk-or-v1-...
export LLM_API_MAX_WORKERS=10

# –ó–∞—Ç–µ–º –∑–∞–ø—É—Å–∫–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—É
python main_pipeline.py all \
  --force \
  --llm-clean \
  --min-usefulness 0.5 \
  --optimize \
  --optimize-mode quick \
  --optimize-sample 50
```

**–ü–æ—á–µ–º—É API —Ä–µ–∂–∏–º:**
- ‚ö° –£—Å–∫–æ—Ä–µ–Ω–∏–µ –≤ 5-20 —Ä–∞–∑
- üöÄ –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- üí∞ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∂–∏–º–æ–≤ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

| –†–µ–∂–∏–º | –ö–æ–º–±–∏–Ω–∞—Ü–∏–π | –í–æ–ø—Ä–æ—Å–æ–≤ | –í—Ä–µ–º—è | –¢–æ—á–Ω–æ—Å—Ç—å |
|-------|-----------|----------|------|----------|
| `test` | 5 | 5 | ~10 –º–∏–Ω | 0.75-0.80 |
| `quick` | 54 | 50 | ~1-2 —á–∞—Å–∞ | 0.85-0.90 |
| `full` | 1225 | 100 | ~3-4 —á–∞—Å–∞ | 0.90-0.95+ |

---

## üéØ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

### 1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ª—É—á—à—É—é LLM –º–æ–¥–µ–ª—å

```bash
# –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–ø–æ –∫–∞—á–µ—Å—Ç–≤—É):
export LLM_API_MODEL=openrouter/sherlock-think-alpha  # reasoning –º–æ–¥–µ–ª—å, 1.8M –∫–æ–Ω—Ç–µ–∫—Å—Ç

# –ü–ª–∞—Ç–Ω—ã–µ –º–æ–¥–µ–ª–∏ (–µ—â–µ –ª—É—á—à–µ):
export LLM_API_MODEL=openai/gpt-4o-mini  # –±—ã—Å—Ç—Ä–æ –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
export LLM_API_MODEL=anthropic/claude-3-haiku  # –æ—á–µ–Ω—å –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ
```

### 2. –£–≤–µ–ª–∏—á—å—Ç–µ —Å—Ç—Ä–æ–≥–æ—Å—Ç—å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏

```bash
# –ë–æ–ª–µ–µ —Å—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (—É–¥–∞–ª—è–µ—Ç –±–æ–ª—å—à–µ –º—É—Å–æ—Ä–∞)
--min-usefulness 0.6  # –≤–º–µ—Å—Ç–æ 0.5

# –ò–ª–∏ –¥–∞–∂–µ:
--min-usefulness 0.7  # —Ç–æ–ª—å–∫–æ –æ—á–µ–Ω—å –ø–æ–ª–µ–∑–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã
```

**–í–Ω–∏–º–∞–Ω–∏–µ:** –°–ª–∏—à–∫–æ–º —Å—Ç—Ä–æ–≥–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è (0.7+) –º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –ø–æ–ª–µ–∑–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã!

### 3. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤–∫–ª—é—á–µ–Ω—ã –≤—Å–µ —É–ª—É—á—à–µ–Ω–∏—è

–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤ `src/config.py`:
- ‚úÖ `ENABLE_QUERY_EXPANSION = True`
- ‚úÖ `ENABLE_RRF = True`
- ‚úÖ `ENABLE_CONTEXT_WINDOW = True`
- ‚úÖ `ENABLE_METADATA_FILTER = True`
- ‚úÖ `ENABLE_USEFULNESS_FILTER = True`
- ‚úÖ `ENABLE_DYNAMIC_TOP_K = True`
- ‚úÖ `RERANKER_TYPE = "cross_encoder"` –∏–ª–∏ `"llm"`

### 4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ LLM reranker (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)

```bash
export RERANKER_TYPE=llm  # –≤–º–µ—Å—Ç–æ cross_encoder
```

LLM reranker –æ–±—ã—á–Ω–æ —Ç–æ—á–Ω–µ–µ, –Ω–æ –º–µ–¥–ª–µ–Ω–Ω–µ–µ.

---

## üöÄ –ò—Ç–æ–≥–æ–≤–∞—è –∫–æ–º–∞–Ω–¥–∞ –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

```bash
# 1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ API
export LLM_MODE=api
export LLM_API_MODEL=openrouter/sherlock-think-alpha  # –∏–ª–∏ –ª—É—á—à–∞—è –º–æ–¥–µ–ª—å
export OPENROUTER_API_KEY=sk-or-v1-...
export LLM_API_MAX_WORKERS=10
export RERANKER_TYPE=llm  # –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏

# 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
python main_pipeline.py check-env

# 3. –ó–∞–ø—É—Å–∫ —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
python main_pipeline.py all \
  --force \
  --llm-clean \
  --min-usefulness 0.5 \
  --optimize \
  --optimize-mode full \
  --optimize-sample 100
```

**–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:**
- **–¢–æ—á–Ω–æ—Å—Ç—å:** 0.90-0.95+
- **–í—Ä–µ–º—è:** ~4-6 —á–∞—Å–æ–≤ (—Å API —Ä–µ–∂–∏–º–æ–º)
- **–ü—Ä–∏—Ä–æ—Å—Ç:** +70-115% –Ω–∞–¥ baseline

---

## üìà –ü—Ä–æ–≥—Ä–µ—Å—Å–∏—è —Ç–æ—á–Ω–æ—Å—Ç–∏

1. **–ë–∞–∑–æ–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç** (–±–µ–∑ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏):
   ```bash
   python main_pipeline.py all --force
   ```
   –¢–æ—á–Ω–æ—Å—Ç—å: ~0.65-0.70

2. **–° LLM –æ—á–∏—Å—Ç–∫–æ–π**:
   ```bash
   python main_pipeline.py all --force --llm-clean
   ```
   –¢–æ—á–Ω–æ—Å—Ç—å: ~0.75-0.80 (+15%)

3. **–° –±—ã—Å—Ç—Ä–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π**:
   ```bash
   python main_pipeline.py all --force --llm-clean --optimize --optimize-mode quick --optimize-sample 50
   ```
   –¢–æ—á–Ω–æ—Å—Ç—å: ~0.85-0.90 (+30%)

4. **–° –ø–æ–ª–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π** (–º–∞–∫—Å–∏–º—É–º):
   ```bash
   python main_pipeline.py all --force --llm-clean --min-usefulness 0.5 --optimize --optimize-mode full --optimize-sample 100
   ```
   –¢–æ—á–Ω–æ—Å—Ç—å: ~0.90-0.95+ (+50-70%)

---

## ‚ö° –ë—ã—Å—Ç—Ä—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–µ—Å–ª–∏ –Ω–µ—Ç –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ full)

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–ª–æ–∂–∏—Ç—å—Å—è –≤ 8 —á–∞—Å–æ–≤, –Ω–æ –ø–æ–ª—É—á–∏—Ç—å —Ö–æ—Ä–æ—à—É—é —Ç–æ—á–Ω–æ—Å—Ç—å:

```bash
export LLM_MODE=api
export LLM_API_MODEL=tngtech/deepseek-r1t2-chimera:free
export OPENROUTER_API_KEY=sk-or-v1-...

python main_pipeline.py all \
  --force \
  --llm-clean \
  --min-usefulness 0.5 \
  --optimize \
  --optimize-mode quick \
  --optimize-sample 50
```

**–û–∂–∏–¥–∞–µ–º–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å:** ~0.85-0.90
**–í—Ä–µ–º—è:** ~2-3 —á–∞—Å–∞ (—Å API —Ä–µ–∂–∏–º–æ–º)

---

## üí° –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã

1. **`--optimize-mode test`** - —Ç–æ–ª—å–∫–æ –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –Ω–µ –¥–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
2. **`--optimize-sample 5`** - —Å–ª–∏—à–∫–æ–º –º–∞–ª–æ, –º–∏–Ω–∏–º—É–º 30-50 –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
3. **`--min-usefulness 0.5`** - –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –∫–∞—á–µ—Å—Ç–≤–æ–º –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤
4. **API —Ä–µ–∂–∏–º –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω** - —É—Å–∫–æ—Ä—è–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –≤ 5-20 —Ä–∞–∑
5. **`--optimize-mode full`** - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –≤—Ä–µ–º—è –∏ –Ω—É–∂–Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ç–æ—á–Ω–æ—Å—Ç—å

